---
version: '3.7'

services:

  peertube:
    container_name: peertube
    hostname: peertube
    image: peertube
    build:
      context: ./peertube
    networks:
      - default
      - planet-link
    env_file:
      - .env

    expose:
      - '1935'
      - '9000'
    volumes:
      - ./docker-volume/assets:/app/client/dist
      - ./docker-volume/data:/data
      - ./docker-volume/config:/config
    depends_on:
      - postgres
      - redis
      - postfix
    restart: "always"

  postgres:
    image: postgres:13-alpine
    env_file:
      - .env
    volumes:
      - ./docker-volume/db:/var/lib/postgresql/data
    restart: "always"

  redis:
    image: redis:6-alpine
    volumes:
      - ./docker-volume/redis:/data
    restart: "always"

  postfix:
    image: mwader/postfix-relay
    env_file:
      - .env
    volumes:
      - ./docker-volume/opendkim/keys:/etc/opendkim/keys
    restart: "always"

networks:
  default:
  planet-link:
    external:
      name: planet-link
